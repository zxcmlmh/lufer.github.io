<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="传感器，视频监控与展示网站的简易解决方案"><meta name="keywords" content=".NET,PHP"><meta name="author" content="Lufer"><meta name="copyright" content="Lufer"><title>传感器，视频监控与展示网站的简易解决方案 | Lufer</title><link rel="shortcut icon" href="http://pic.lufer.cc/images/2021/03/05/eI1NJH.png"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e2cd7e52254704223bd3b9c0461bc06e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script src="https://www.googletagmanager.com/gtag/js?id=G-T5L2KPFS29"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-T5L2KPFS29');</script><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"D3K0O2R6F2","apiKey":"4e808ae377111360493e99d31970584c","indexName":"BLOG_LUFER","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.3.0'
} </script><meta name="generator" content="Hexo 5.3.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://pic.lufer.cc/images/2021/03/05/eI1UWd.jpg"></div><div class="author-info__name text-center">Lufer</div><div class="author-info__description text-center">新的一天开始啦</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">63</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">30</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">16</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">大佬们</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://www.yuque.com/grace-gu">Grace</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://1ogisk.cn/">Logik</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://blog.legume.ltd">豆哥</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://esportnosave.cn/">EsportsNoSave</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://pic.lufer.cc/images/2021/03/05/eI1dSA.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Lufer</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/tags">标签</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">传感器，视频监控与展示网站的简易解决方案</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-06-15</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/PHP/">PHP</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/PHP/NET/">.NET</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">1.8k</span><span class="post-meta__separator">|</span><span>阅读时长: 8 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>  其实这个项目已经完成一段时间了，今天才想起来记录一下。 网站部分基于PHP，客户端用C#。 先贴效果图。</p>
<p><img src="http://pic.lufer.cc/images/2021/03/05/e4xVGn.jpg" alt="" /></p>
<p><img src="http://pic.lufer.cc/images/2021/03/05/e4xZ2q.jpg" alt="" /></p>
<p><img src="http://pic.lufer.cc/images/2021/03/05/e4xk5j.jpg" alt="" /></p>
<p><img src="http://pic.lufer.cc/images/2021/03/05/e4xFaQ.jpg" alt="" /></p>
<p><img src="http://pic.lufer.cc/images/2021/03/05/e4xiVg.jpg" alt="" /></p>
<p>  登录注册验证</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$conn</span> = mysql_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">mysql_select_db(<span class="string">&quot;design&quot;</span>, <span class="variable">$conn</span>);</span><br><span class="line">mysql_query(<span class="string">&quot;SET NAMES &#x27;UTF8&#x27;&quot;</span>,<span class="variable">$conn</span>);</span><br><span class="line"><span class="comment">//以用户名为条件，构建数据库查询语句</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from user where username=&#x27;<span class="subst">$name</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$Result</span> = mysql_query(<span class="variable">$sql</span>, <span class="variable">$conn</span>);</span><br><span class="line"><span class="comment">//如果查到了记录，说明这个用户名已经注册了，进行提示，然后跳转回注册页</span></span><br><span class="line"><span class="keyword">if</span>(mysql_num_rows(<span class="variable">$Result</span>)&gt;<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&quot;alert(&#x27;注册失败，用户名已存在&#x27;);location=&#x27;../regist.php&#x27;;&quot;</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//在表user中插入一条记录，将用户名和密码保存进去</span></span><br><span class="line">    <span class="variable">$sql2</span> = <span class="string">&quot;insert into user(username,password) value(&#x27;<span class="subst">$name</span>&#x27;,&#x27;<span class="subst">$password</span>&#x27;)&quot;</span>;</span><br><span class="line">    <span class="comment">//如果插入语句执行成功，则将用户名写入session，然后进行提示，跳转到后台页面</span></span><br><span class="line">    <span class="keyword">if</span> (  mysql_query(<span class="variable">$sql2</span>, <span class="variable">$conn</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]=<span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">echo</span><span class="string">&quot;alert(&#x27;注册成功&#x27;);location=&#x27;../temp-manager.php&#x27;;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span> = mysql_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"><span class="comment">//选择数据库design</span></span><br><span class="line">mysql_select_db(<span class="string">&quot;design&quot;</span>, <span class="variable">$conn</span>);</span><br><span class="line"><span class="comment">//设置编码方式为UTF8</span></span><br><span class="line">mysql_query(<span class="string">&quot;SET NAMES &#x27;UTF8&#x27;&quot;</span>,<span class="variable">$conn</span>);</span><br><span class="line"><span class="comment">//编写查询语句，以用户名和密码作为条件在数据库中进行查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from user where username=&#x27;<span class="subst">$name</span>&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//获取查询结果</span></span><br><span class="line"><span class="variable">$Result</span> = mysql_query(<span class="variable">$sql</span>, <span class="variable">$conn</span>);</span><br><span class="line"><span class="comment">//在结果中取出第一行</span></span><br><span class="line"><span class="variable">$onerow</span> = mysql_fetch_array(<span class="variable">$Result</span>);</span><br><span class="line"><span class="comment">//如果存在这么一行，说明查到了结果，用户名和密码匹配</span></span><br><span class="line"><span class="keyword">if</span> (  <span class="variable">$onerow</span> )</span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">//session中存入用户名，然后跳转到后台页面</span></span><br><span class="line">   <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]=<span class="variable">$onerow</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">   <span class="keyword">echo</span><span class="string">&quot;location=&#x27;../temp-manager.php&#x27;;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//没有查询到记录，说明用户名或者密码错误，进行提示然后跳转回登录页</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="keyword">echo</span><span class="string">&quot;alert(&#x27;密码错误&#x27;);location=&#x27;../index.php&#x27;;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>  用户登录状态保存</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//登录时</span></span><br><span class="line"><span class="comment">//生成一个session，用户保存用户的登录状态</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="comment">//session中存入用户名</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]=<span class="variable">$onerow</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="comment">//注销时</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="comment">//使用一个会话变量检查登录状态</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//要清除会话变量，将$_SESSION超级全局变量设置为一个空数组</span></span><br><span class="line">  <span class="variable">$_SESSION</span> = <span class="keyword">array</span>();</span><br><span class="line">  <span class="comment">//如果存在一个会话cookie，通过将到期时间设置为之前1个小时从而将其删除</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[session_name()]))&#123;</span><br><span class="line">    setcookie(session_name(),<span class="string">&#x27;&#x27;</span>,time()<span class="number">-3600</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//使用内置session_destroy()函数调用撤销会话</span></span><br><span class="line">  session_destroy();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  客户端登录验证与发包</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> username = textBox1.Text;                <span class="comment">//将用户名文本框中的值保存到字符串变量username中</span></span><br><span class="line"><span class="keyword">string</span> password = textBox2.Text;                <span class="comment">//将密码文本框中的值保存到password</span></span><br><span class="line"><span class="keyword">string</span> result = <span class="string">&quot;&quot;</span>;                             <span class="comment">//初始化result变量，赋空值</span></span><br><span class="line"><span class="keyword">string</span> url = <span class="string">&quot;http://127.0.0.1//helper//clientlogin.php&quot;</span>;          <span class="comment">//将通信的目标连接地址保存到url中</span></span><br><span class="line">HttpWebRequest req = (HttpWebRequest)WebRequest.Create(url);       <span class="comment">//调用系统Http请求库，初始化对象</span></span><br><span class="line">req.Method = <span class="string">&quot;POST&quot;</span>;                                               <span class="comment">//设定请求方式为“POST”</span></span><br><span class="line">req.ContentType = <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>;             <span class="comment">//设定文本编码方式   不用了解这个的意义 </span></span><br><span class="line">StringBuilder builder = <span class="keyword">new</span> StringBuilder();                       <span class="comment">//构造请求的参数字符串</span></span><br><span class="line">builder.AppendFormat(<span class="string">&quot;name=&quot;</span> + username);                          <span class="comment">//添加name参数</span></span><br><span class="line">builder.AppendFormat(<span class="string">&quot;&amp;password=&quot;</span> + password);                     <span class="comment">//添加password参数</span></span><br><span class="line">byte[] data = Encoding.UTF8.GetBytes(builder.ToString());          <span class="comment">//将字符串构造成字节流</span></span><br><span class="line">req.ContentLength = data.Length;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">     using (Stream reqStream = req.GetRequestStream())</span><br><span class="line">     &#123;</span><br><span class="line">          reqStream.Write(data, <span class="number">0</span>, data.Length);</span><br><span class="line">          reqStream.Close();</span><br><span class="line">     &#125;</span><br><span class="line">     HttpWebResponse resp = (HttpWebResponse)req.GetResponse();      <span class="comment">//进行通信，获取返回值</span></span><br><span class="line">     Stream stream = resp.GetResponseStream();</span><br><span class="line">     <span class="comment">//获取响应内容  </span></span><br><span class="line">     using (StreamReader reader = <span class="keyword">new</span> StreamReader(stream, Encoding.UTF8))</span><br><span class="line">     &#123;</span><br><span class="line">          result = reader.ReadToEnd();                                <span class="comment">//把返回值保存到result中</span></span><br><span class="line">          <span class="keyword">return</span> result;                                              <span class="comment">//返回result</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (<span class="built_in">Exception</span> e)</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">return</span> e.Message;                                               <span class="comment">//如果过程中出现异常，返回异常信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  UNIX时间戳转换</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Highchart默认使用UNIX时间戳，为了便于后面的显示进行转换</span></span><br><span class="line"><span class="comment">//获取时间</span></span><br><span class="line">DateTime startTime = TimeZone.CurrentTimeZone.ToLocalTime(<span class="keyword">new</span> System.DateTime(<span class="number">1970</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">DateTime nowTime = DateTime.Now;</span><br><span class="line"><span class="comment">//转换为UNIX时间戳</span></span><br><span class="line">long unixTime = (long)Math.Round((nowTime - startTime).TotalMilliseconds, MidpointRounding.AwayFromZero);</span><br></pre></td></tr></table></figure>
<p>  HighChart动态表格的实现</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> tempdata=<span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">$.get(<span class="string">&quot;helper/firsthumi.php&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> jsonObj = <span class="built_in">eval</span>(<span class="string">&#x27;(&#x27;</span> + data + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//var list=data.dataList;</span></span><br><span class="line">	<span class="comment">//console.log(list);</span></span><br><span class="line">	<span class="keyword">var</span> time,temp;</span><br><span class="line">	$.each(jsonObj.dataList, <span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;</span><br><span class="line">		time=<span class="built_in">parseInt</span>(item.time);</span><br><span class="line">		humi=<span class="built_in">parseFloat</span>(item.humi);</span><br><span class="line">		humidata.push(&#123;</span><br><span class="line">			x: time,</span><br><span class="line">			y: humi</span><br><span class="line">		&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">		$(<span class="string">&#x27;#container2&#x27;</span>).highcharts(&#123;</span><br><span class="line">			chart: &#123;</span><br><span class="line">				type: <span class="string">&#x27;spline&#x27;</span>,</span><br><span class="line">				animation: Highcharts.svg, <span class="comment">// don&#x27;t animate in old IE</span></span><br><span class="line">				marginRight: <span class="number">10</span>,</span><br><span class="line">				events: &#123;</span><br><span class="line">					load: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">						<span class="comment">// set up the updating of the chart each second</span></span><br><span class="line">						<span class="keyword">var</span> series = <span class="built_in">this</span>.series[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">								<span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">									<span class="keyword">var</span> jsonobj=$.ajax(&#123;</span><br><span class="line">										url:<span class="string">&quot;helper/loadhumi.php&quot;</span>,</span><br><span class="line">										<span class="keyword">async</span>:<span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">									&#125;);</span><br><span class="line">									<span class="keyword">var</span> x,y;</span><br><span class="line">									<span class="keyword">var</span> jjj=<span class="built_in">eval</span>(<span class="string">&#x27;(&#x27;</span> + jsonobj.responseText + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">									x=<span class="built_in">parseInt</span>(jjj.dataList[<span class="number">0</span>].time);</span><br><span class="line">									y=<span class="built_in">parseFloat</span>(jjj.dataList[<span class="number">0</span>].humi);</span><br><span class="line">									<span class="keyword">var</span> divhumi = $(<span class="string">&quot;#curhumi&quot;</span>);</span><br><span class="line">									divhumi.text(<span class="string">&quot;&quot;</span>);<span class="comment">// 清空数据</span></span><br><span class="line">    							divhumi.append(<span class="string">&quot;当前湿度为:&quot;</span>+y+<span class="string">&quot;%&quot;</span>);</span><br><span class="line">									series.addPoint([x, y], <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">								&#125;, <span class="number">1000</span>);</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			,</span><br><span class="line">			title: &#123;</span><br><span class="line">				text: <span class="string">&#x27;湿度走势图--1秒&#x27;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			xAxis: &#123;</span><br><span class="line">				type: <span class="string">&#x27;datetime&#x27;</span>,</span><br><span class="line">				tickPixelInterval: <span class="number">100</span></span><br><span class="line">			&#125;,</span><br><span class="line">			yAxis: &#123;</span><br><span class="line">				title: &#123;</span><br><span class="line">					text: <span class="string">&#x27;湿度/%&#x27;</span></span><br><span class="line">				&#125;,</span><br><span class="line">				plotLines: [&#123;</span><br><span class="line">					value: <span class="number">0</span>,</span><br><span class="line">					width: <span class="number">1</span>,</span><br><span class="line">					color: <span class="string">&#x27;#808080&#x27;</span></span><br><span class="line">				&#125;]</span><br><span class="line">			&#125;,</span><br><span class="line">			tooltip: &#123;</span><br><span class="line">				formatter: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">						<span class="keyword">return</span> <span class="string">&#x27;&lt;b&gt;&#x27;</span>+ <span class="built_in">this</span>.series.name +<span class="string">&#x27;&lt;/b&gt;&lt;br/&gt;&#x27;</span>+</span><br><span class="line">						Highcharts.dateFormat(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, <span class="built_in">this</span>.x) +<span class="string">&#x27;&lt;br/&gt;&#x27;</span>+</span><br><span class="line">						Highcharts.numberFormat(<span class="built_in">this</span>.y, <span class="number">2</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			legend: &#123;</span><br><span class="line">				enabled: <span class="literal">false</span></span><br><span class="line">			&#125;,</span><br><span class="line">			exporting: &#123;</span><br><span class="line">				enabled: <span class="literal">false</span></span><br><span class="line">			&#125;,</span><br><span class="line">			series: [&#123;</span><br><span class="line">				name: <span class="string">&#x27;湿度数据&#x27;</span>,</span><br><span class="line">				data: humidata</span><br><span class="line">			&#125;]</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>
<p>  EasyUi动态表格的实现</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取数据</span></span><br><span class="line"> $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">             <span class="comment">//动态加载标题和数据</span></span><br><span class="line">             $.ajax(&#123;</span><br><span class="line">                 url: <span class="string">&quot;helper/getprofile.php&quot;</span>,</span><br><span class="line">                 type: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">                 dataType: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">                 success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">									  <span class="comment">//将取回的数据加载到datagrid中</span></span><br><span class="line">                    $(<span class="string">&quot;#dg&quot;</span>).datagrid(<span class="string">&quot;loadData&quot;</span>, data.dataList);</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;);</span><br><span class="line">        &#125;); </span><br><span class="line"><span class="comment">//删除行</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeit</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (editIndex == <span class="literal">undefined</span>)&#123;<span class="keyword">return</span>&#125;</span><br><span class="line">      <span class="comment">//获取当前选中的行</span></span><br><span class="line">      <span class="keyword">var</span> row = $(<span class="string">&#x27;#dg&#x27;</span>).datagrid(<span class="string">&#x27;getSelections&#x27;</span>);</span><br><span class="line">      <span class="comment">//获取该行任命</span></span><br><span class="line">      <span class="keyword">var</span> name=row[<span class="number">0</span>].name;</span><br><span class="line">      <span class="comment">//进行提示，如果用户点击确认触发ajax请求</span></span><br><span class="line">      <span class="keyword">if</span>(<span class="built_in">window</span>.confirm(<span class="string">&#x27;你确定要删除联系人&#x27;</span>+name+<span class="string">&#x27;吗？&#x27;</span>))</span><br><span class="line">      &#123;</span><br><span class="line">	      <span class="comment">//发送请求，参数为该行数据</span></span><br><span class="line">	      $.ajax(&#123;</span><br><span class="line">              url : <span class="string">&#x27;helper/profiledelete.php&#x27;</span>,</span><br><span class="line">              data : row[<span class="number">0</span>],</span><br><span class="line">              dataType : <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">              success : <span class="function"><span class="keyword">function</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">                  <span class="keyword">if</span> (r.success) &#123;</span><br><span class="line">		      <span class="comment">//成功后进行提示</span></span><br><span class="line">		      alert(<span class="string">&quot;删除成功！&quot;</span>);</span><br><span class="line">		      <span class="comment">//在表格中删除该行</span></span><br><span class="line">                      $(<span class="string">&#x27;#dg&#x27;</span>).datagrid(<span class="string">&#x27;cancelEdit&#x27;</span>, editIndex)</span><br><span class="line">                         .datagrid(<span class="string">&#x27;deleteRow&#x27;</span>, editIndex);</span><br><span class="line">                     editIndex = <span class="literal">undefined</span>;</span><br><span class="line">	             <span class="comment">//重置表格的记录修改状态</span></span><br><span class="line">                     $(<span class="string">&#x27;#dg&#x27;</span>).datagrid(<span class="string">&#x27;acceptChanges&#x27;</span>);</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">           &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//保存记录</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">accept</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (endEditing())&#123;</span><br><span class="line">	<span class="comment">//获取所有发生了更改的行</span></span><br><span class="line">        <span class="keyword">var</span> rows = $(<span class="string">&#x27;#dg&#x27;</span>).datagrid(<span class="string">&#x27;getChanges&#x27;</span>);</span><br><span class="line">	<span class="comment">//将数组转为字符串</span></span><br><span class="line">        <span class="keyword">var</span> row=<span class="built_in">JSON</span>.stringify(rows);</span><br><span class="line">	<span class="comment">//发送请求</span></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            url : <span class="string">&#x27;helper/profileupdate.php&#x27;</span>,</span><br><span class="line">            data : &#123;</span><br><span class="line">              rows:row</span><br><span class="line">            &#125;,</span><br><span class="line">            dataType : <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">            success : <span class="function"><span class="keyword">function</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (r.success) &#123;</span><br><span class="line">									<span class="comment">//成功后进行提示，并重置更改状态</span></span><br><span class="line">                    alert(<span class="string">&quot;保存成功！&quot;</span>);</span><br><span class="line">                   editIndex = <span class="literal">undefined</span>;</span><br><span class="line">                   $(<span class="string">&#x27;#dg&#x27;</span>).datagrid(<span class="string">&#x27;acceptChanges&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  视频监控的简易实现方式</p>
<p>  使用OBS+FMS作为客户端和服务端软件，前端页面嵌入CKplayer来进行显示 OBS只要设置好推流地址就可以了。</p>
<p><img src="http://pic.lufer.cc/images/2021/03/05/e4xEPs.jpg" alt="" /></p>
<p>  播放路径可以按用户名来，距离这里写test FMS不用设置，安装好后全部运行即可 随后对CKPlayer进行修改。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//将当前用户拼接到直播流地址后面，生成新的地址字符串</span></span><br><span class="line"><span class="keyword">var</span> url=<span class="string">&quot;rtmp://127.0.0.1/live/&quot;</span>+username;</span><br><span class="line"><span class="keyword">var</span> flashvars=&#123;</span><br><span class="line">	f:url,</span><br><span class="line">	c:<span class="number">0</span></span><br><span class="line">	&#125;;</span><br><span class="line"><span class="keyword">var</span> params=&#123;<span class="attr">bgcolor</span>:<span class="string">&#x27;#FFF&#x27;</span>,<span class="attr">allowFullScreen</span>:<span class="literal">true</span>,<span class="attr">allowScriptAccess</span>:<span class="string">&#x27;always&#x27;</span>,<span class="attr">wmode</span>:<span class="string">&#x27;transparent&#x27;</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> video=\[<span class="string">&#x27;http://movie.ks.js.cn/flv/other/1_0.mp4-&gt;video/mp4&#x27;</span>\];</span><br><span class="line">CKobject.embed(<span class="string">&#x27;/ckplayer/ckplayer.swf&#x27;</span>,<span class="string">&#x27;a1&#x27;</span>,<span class="string">&#x27;ckplayer_a1&#x27;</span>,<span class="string">&#x27;100%&#x27;</span>,<span class="string">&#x27;100%&#x27;</span>,<span class="literal">false</span>,flashvars,video,params);</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Lufer</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://coder.lufer.cc/2017/06/15/传感器，视频监控与展示网站的简易解决方案/">https://coder.lufer.cc/2017/06/15/传感器，视频监控与展示网站的简易解决方案/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://coder.lufer.cc">Lufer</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/NET/">.NET</a><a class="post-meta__tags" href="/tags/PHP/">PHP</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2017/12/28/CentOS%20%E4%BF%9D%E7%95%99Python2.6%E5%AE%89%E8%A3%85Python2.7%E5%B9%B6%E5%AE%89%E8%A3%85Pip/"><i class="fa fa-chevron-left">  </i><span>CentOS保留Python2.6安装Python2.7并安装Pip</span></a></div><div class="next-post pull-right"><a href="/2017/03/26/CSGO%20%E8%BF%99%E5%8F%AF%E8%83%BD%E6%98%AF%E5%94%AF%E4%B8%80%E4%B8%80%E4%B8%AA%E6%88%91%E8%83%BD%E7%8E%A9%E4%B8%80%E8%BE%88%E5%AD%90%E7%9A%84%E6%B8%B8%E6%88%8F/"><span>CSGO 这可能是唯一一个我能玩一辈子的游戏</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'true' == 'true';
var verify = 'false' == 'true';
var record_ip = '' == 'true';
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  recordIP:record_ip,
  appId:'VqMxq8YhQKdt87hjlDYA4UDq-MdYXbMMI',
  appKey:'jMbPNFw1782lMDtEz6mIwhx4',
  placeholder:'早8点-晚11点会自动发送邮件提醒',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div><footer class="footer-bg" style="background-image: url(http://pic.lufer.cc/images/2021/03/05/eI1dSA.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2016 - 2021 By Lufer</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/algolia.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>